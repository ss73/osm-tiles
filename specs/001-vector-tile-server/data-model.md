# Data Model: Self-Hosted Vector Tile Server

**Date**: 2026-02-16
**Feature**: 001-vector-tile-server

## Overview

This project is infrastructure-oriented — it assembles and configures
open-source tools rather than building a custom application. The "data
model" describes the files and resources the system manages, not
database entities.

## File-Based Resources

### Tileset (MBTiles file)

A single MBTiles file containing all vector tiles for the coverage area.

- **Source**: Generated by Planetiler from an OSM PBF extract
- **Format**: SQLite database following the MBTiles specification
- **Content**: Mapbox Vector Tiles (MVT/PBF) for zoom levels 0–14
- **Schema**: OpenMapTiles — layers include transportation, building,
  water, landuse, place, poi, boundary, park, aeroway, waterway
- **Identity**: One tileset per coverage area (e.g., `sweden.mbtiles`)
- **Lifecycle**: Generated → Served → Replaced on update
- **Size**: ~1-5 GB for a single country

### Style (JSON file)

A MapLibre Style Spec JSON document defining visual rendering rules.

- **Format**: JSON following the MapLibre Style Spec
- **References**: Points to tile source, font glyphs endpoint, and
  sprite sheet endpoint on the same server
- **Variants**: Multiple independent files (e.g., osm-liberty.json,
  positron.json, dark-matter.json)
- **Lifecycle**: Version-controlled → Deployed → Editable at any time
  without affecting tiles
- **Identity**: Named by filename, served at `/style/{name}`

### Font (TTF/OTF file)

TrueType or OpenType font files used for map label rendering.

- **Format**: TTF or OTF (Martin generates PBF glyph ranges on-the-fly)
- **Served as**: PBF glyph ranges at `/font/{fontstack}/{range}`
- **Primary fonts**: Noto Sans Regular, Noto Sans Bold
- **Lifecycle**: Version-controlled → Deployed → Rarely changed

### Sprite Source (SVG files)

Individual SVG icon files that Martin composites into sprite sheets.

- **Format**: SVG files in a named directory
- **Served as**: PNG + JSON sprite sheets at `/sprite/{name}`
  (both 1x and @2x variants)
- **Source**: Maki icon set from OSM Liberty
- **Lifecycle**: Version-controlled → Deployed → Add/remove icons
  as needed

### OSM Data Extract (PBF file)

The raw OpenStreetMap data used as input for tile generation.

- **Format**: OSM PBF (Protocol Buffer Format)
- **Source**: Geofabrik regional extracts
- **Size**: ~753 MB for Sweden
- **Lifecycle**: Downloaded → Used by Planetiler → Can be deleted
  after tile generation (or kept for reference)
- **Not served**: Input only, never exposed via the tile server

## Resource Relationships

```
OSM PBF Extract
    │
    ▼ (Planetiler generates)
MBTiles Tileset ◄──── Style JSON references tile source
    │                      │
    ▼                      ├──── references font endpoint
Martin serves ◄───────────┤
    │                      └──── references sprite endpoint
    ├── /tiles/{z}/{x}/{y}
    ├── /style/{name}
    ├── /font/{fontstack}/{range}
    └── /sprite/{name}[.json|.png|@2x.json|@2x.png]
```

## Data Volume Estimates (Sweden)

| Resource | Size | Count |
|----------|------|-------|
| OSM PBF extract | ~753 MB | 1 file |
| MBTiles tileset | ~1-5 GB | 1 file |
| Style JSON files | ~200-500 KB each | 3 files |
| Font files (TTF) | ~1-5 MB each | 2-4 files |
| Sprite SVGs | ~1-10 KB each | 50-200 files |
| Total disk (excluding PBF) | ~2-6 GB | — |

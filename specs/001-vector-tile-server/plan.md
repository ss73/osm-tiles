# Implementation Plan: Self-Hosted Vector Tile Server

**Branch**: `001-vector-tile-server` | **Date**: 2026-02-16 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-vector-tile-server/spec.md`

## Summary

Set up a self-hosted vector tile server that serves OpenStreetMap
vector tiles with custom styles, compatible with MapLibre GL JS and
Leaflet. Uses Planetiler for tile generation (OSM PBF → MBTiles) and
Martin for serving tiles, styles, fonts, and sprites from a single
Docker container. Initial coverage: single country (Sweden).

## Technical Context

**Tile Generation**: Planetiler v0.10.0 (Java, Docker image)
**Tile Server**: Martin v1.3.1 (Rust, Docker image ~12 MB)
**Storage**: MBTiles (SQLite) — single file per coverage area
**Base Styles**: OSM Liberty, Positron, Dark Matter (MapLibre Style Spec JSON)
**Fonts**: Noto Sans Regular + Bold (TTF, served dynamically by Martin)
**Sprites**: Maki SVG icons (served dynamically by Martin)
**Client Libraries**: MapLibre GL JS (primary), Leaflet + maplibre-gl-leaflet (secondary)
**Target Platform**: Linux server (Docker/Podman), single machine
**Project Type**: Infrastructure/configuration — no custom application code
**Performance Goals**: <1s tile response, <3s initial map load, 1–10 concurrent users
**Constraints**: Single machine, ~10 GB disk, 4+ GB RAM
**Scale/Scope**: Single country extract (Sweden ~753 MB PBF → ~1-5 GB MBTiles)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Evidence |
|-----------|--------|----------|
| I. Open Standards | PASS | MVT tiles, MBTiles storage, MapLibre Style Spec JSON, self-hosted fonts/sprites |
| II. Leverage Existing Tools | PASS | Planetiler for generation, Martin for serving. No custom tile engine code |
| III. Client Compatibility | PASS | MapLibre GL JS primary, Leaflet via maplibre-gl-leaflet plugin |
| IV. Style Ownership | PASS | Style JSON files version-controlled in repo, editable without tile regeneration |
| V. Operational Simplicity | PASS | Two Docker containers (one-time generator + server), single machine, documented update process |

**Post-Phase 1 re-check**: All gates still pass. Martin's dynamic
font/sprite generation further simplifies operations (no build
pipeline for fonts or sprites).

## Project Structure

### Documentation (this feature)

```text
specs/001-vector-tile-server/
├── plan.md              # This file
├── research.md          # Tool evaluation and decisions
├── data-model.md        # File-based resource descriptions
├── quickstart.md        # Step-by-step setup guide
├── contracts/
│   └── endpoints.md     # Martin API endpoints
└── tasks.md             # Generated by /speckit.tasks
```

### Source Code (repository root)

```text
docker-compose.yml           # Martin tile server + volume mounts
styles/
├── osm-liberty.json         # Primary style (general purpose)
├── positron.json            # Light/minimal variant
└── dark-matter.json         # Dark variant
fonts/
├── NotoSans-Regular.ttf     # Primary label font
└── NotoSans-Bold.ttf        # Bold variant
sprites/
└── osm-liberty/             # SVG icons for OSM Liberty style
    ├── airport-11.svg
    ├── bus-11.svg
    └── ...
scripts/
├── generate-tiles.sh        # Run Planetiler to generate MBTiles
└── update-tiles.sh          # Download fresh extract + regenerate + swap
examples/
├── maplibre-demo.html       # MapLibre GL JS demo page
└── leaflet-demo.html        # Leaflet + maplibre-gl-leaflet demo page
data/                        # Gitignored — generated tile data
└── sweden.mbtiles           # Generated by Planetiler
.gitignore                   # Excludes data/ directory
```

**Structure Decision**: This is an infrastructure project, not a
traditional application. The repository contains configuration files
(Docker Compose, style JSON), static assets (fonts, sprites), helper
scripts, and demo pages. No `src/` or `tests/` directories — the
"code" is configuration and glue scripts.

## Complexity Tracking

No constitution violations. No complexity justifications needed.

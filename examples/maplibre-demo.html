<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vector Tile Server — MapLibre GL JS Demo</title>
  <link rel="stylesheet" href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css">
  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    #style-switcher {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1;
      background: white;
      border-radius: 4px;
      padding: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
      font-family: sans-serif;
      font-size: 14px;
    }
    #style-switcher label {
      display: block;
      padding: 4px 0;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="style-switcher">
    <strong>Style</strong>
    <label><input type="radio" name="style" value="osm-liberty" checked> OSM Liberty</label>
    <label><input type="radio" name="style" value="positron"> Positron</label>
    <label><input type="radio" name="style" value="dark-matter"> Dark Matter</label>
    <label><input type="radio" name="style" value="blue-dark"> Blue Dark</label>
    <hr style="margin: 4px 0;">
    <label><input type="checkbox" id="toggle-labels" checked> Labels</label>
    <label><input type="checkbox" id="toggle-borders" checked> Land borders</label>
    <label><input type="checkbox" id="toggle-maritime" checked> Sea borders</label>
    <hr style="margin: 4px 0;">
    <strong>Overlays</strong>
    <label><input type="checkbox" id="toggle-heatmap"> Road density</label>
    <label><input type="checkbox" id="toggle-transit"> Public transport</label>
    <label><input type="checkbox" id="toggle-restaurants"> Restaurants &amp; cafes</label>
    <hr style="margin: 4px 0;">
    <strong>View</strong>
    <label><input type="radio" name="view" value="2d" checked> 2D</label>
    <label><input type="radio" name="view" value="3d"> 3D</label>
    <label style="display: flex; align-items: center; gap: 6px;">Pitch <input type="range" id="pitch-slider" min="0" max="70" value="0" style="width: 80px;"></label>
    <label style="display: flex; align-items: center; gap: 6px;">Bearing <input type="range" id="bearing-slider" min="0" max="360" value="0" style="width: 80px;"></label>
  </div>

  <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
  <script>
    var TILE_SERVER = 'http://localhost:3000';

    var map = new maplibregl.Map({
      container: 'map',
      style: TILE_SERVER + '/style/osm-liberty',
      center: [18.07, 59.33], // Stockholm
      zoom: 10
    });

    map.addControl(new maplibregl.NavigationControl());

    // Feature interaction: show popup on click
    map.on('click', function (e) {
      var features = map.queryRenderedFeatures(e.point);
      if (features.length === 0) return;

      var feature = features[0];
      var props = feature.properties;
      var html = '<strong>' + feature.layer.id + '</strong><br>';
      for (var key in props) {
        if (props.hasOwnProperty(key)) {
          html += key + ': ' + props[key] + '<br>';
        }
      }

      new maplibregl.Popup()
        .setLngLat(e.lngLat)
        .setHTML(html)
        .addTo(map);
    });

    // Read initial checkbox state (browser may restore from previous session)
    var labelsVisible = document.getElementById('toggle-labels').checked;
    var landBordersVisible = document.getElementById('toggle-borders').checked;
    var seaBordersVisible = document.getElementById('toggle-maritime').checked;

    // Toggle labels
    function setLabelsVisibility(visible) {
      var visibility = visible ? 'visible' : 'none';
      map.getStyle().layers.forEach(function (layer) {
        if (layer.type === 'symbol') {
          map.setLayoutProperty(layer.id, 'visibility', visibility);
        }
      });
      labelsVisible = visible;
    }

    document.getElementById('toggle-labels').addEventListener('change', function () {
      setLabelsVisibility(this.checked);
    });

    // Toggle land/sea borders independently
    var originalBoundaryFilters = {};

    function saveBoundaryFilters() {
      originalBoundaryFilters = {};
      map.getStyle().layers.forEach(function (layer) {
        if (layer.id.indexOf('boundary') === 0) {
          originalBoundaryFilters[layer.id] = layer.filter ? JSON.parse(JSON.stringify(layer.filter)) : null;
        }
      });
    }

    function updateBorderFilters() {
      map.getStyle().layers.forEach(function (layer) {
        if (layer.id.indexOf('boundary') !== 0) return;

        if (!landBordersVisible && !seaBordersVisible) {
          map.setLayoutProperty(layer.id, 'visibility', 'none');
          return;
        }

        map.setLayoutProperty(layer.id, 'visibility', 'visible');
        var base = originalBoundaryFilters[layer.id];

        if (landBordersVisible && seaBordersVisible) {
          map.setFilter(layer.id, base);
        } else {
          var maritimeCondition = landBordersVisible ? ['!=', 'maritime', 1] : ['==', 'maritime', 1];
          if (base && base[0] === 'all') {
            map.setFilter(layer.id, base.concat([maritimeCondition]));
          } else if (base) {
            map.setFilter(layer.id, ['all', base, maritimeCondition]);
          } else {
            map.setFilter(layer.id, maritimeCondition);
          }
        }
      });
    }

    document.getElementById('toggle-borders').addEventListener('change', function () {
      landBordersVisible = this.checked;
      updateBorderFilters();
    });

    document.getElementById('toggle-maritime').addEventListener('change', function () {
      seaBordersVisible = this.checked;
      updateBorderFilters();
    });

    // View controls: 2D/3D toggle and pitch/bearing sliders
    var pitchSlider = document.getElementById('pitch-slider');
    var bearingSlider = document.getElementById('bearing-slider');

    document.querySelectorAll('#style-switcher input[name="view"]').forEach(function (input) {
      input.addEventListener('change', function () {
        if (this.value === '3d') {
          map.easeTo({ pitch: 60, bearing: -20, duration: 800 });
          pitchSlider.value = 60;
          bearingSlider.value = 340;
        } else {
          map.easeTo({ pitch: 0, bearing: 0, duration: 800 });
          pitchSlider.value = 0;
          bearingSlider.value = 0;
        }
      });
    });

    pitchSlider.addEventListener('input', function () {
      map.setPitch(Number(this.value));
    });

    bearingSlider.addEventListener('input', function () {
      map.setBearing(Number(this.value));
    });

    // Keep sliders in sync when user drags/rotates the map directly
    map.on('pitchend', function () {
      pitchSlider.value = Math.round(map.getPitch());
    });
    map.on('rotate', function () {
      bearingSlider.value = Math.round((map.getBearing() + 360) % 360);
    });

    // Building density heatmap overlay
    var heatmapVisible = document.getElementById('toggle-heatmap').checked;

    function addHeatmapLayer() {
      if (map.getLayer('road-density-heatmap')) return;
      map.addLayer({
        id: 'road-density-heatmap',
        type: 'heatmap',
        source: 'openmaptiles',
        'source-layer': 'transportation',
        minzoom: 4,
        maxzoom: 16,
        layout: {
          visibility: heatmapVisible ? 'visible' : 'none'
        },
        paint: {
          'heatmap-weight': 1,
          'heatmap-intensity': [
            'interpolate', ['linear'], ['zoom'],
            4, 0.3,
            7, 0.5,
            10, 0.7,
            14, 1
          ],
          'heatmap-radius': [
            'interpolate', ['linear'], ['zoom'],
            4, 6,
            7, 12,
            10, 18,
            14, 30,
            16, 45
          ],
          'heatmap-color': [
            'interpolate', ['linear'], ['heatmap-density'],
            0,    'rgba(0,0,0,0)',
            0.1,  'rgba(0,0,255,0.3)',
            0.2,  'rgba(0,100,255,0.4)',
            0.3,  'rgba(0,200,255,0.5)',
            0.4,  'rgba(0,255,200,0.55)',
            0.5,  'rgba(0,255,100,0.6)',
            0.6,  'rgba(128,255,0,0.65)',
            0.7,  'rgba(255,255,0,0.7)',
            0.8,  'rgba(255,200,0,0.75)',
            0.9,  'rgba(255,128,0,0.8)',
            0.97, 'rgba(255,50,0,0.85)',
            1.0,  'rgba(255,0,0,0.9)'
          ],
          'heatmap-opacity': [
            'interpolate', ['linear'], ['zoom'],
            4, 0.7,
            10, 0.7,
            16, 0.5
          ]
        }
      });
    }

    document.getElementById('toggle-heatmap').addEventListener('change', function () {
      heatmapVisible = this.checked;
      if (map.getLayer('road-density-heatmap')) {
        map.setLayoutProperty('road-density-heatmap', 'visibility', heatmapVisible ? 'visible' : 'none');
      }
    });

    // Public transport overlay
    var transitVisible = document.getElementById('toggle-transit').checked;

    var transitTypes = [
      { id: 'transit-bus',     label: 'B', color: '#E6B800', filter: ['==', ['get', 'class'], 'bus'] },
      { id: 'transit-subway',  label: 'M', color: '#1565C0', filter: ['any', ['all', ['==', ['get', 'class'], 'railway'], ['==', ['get', 'subclass'], 'subway']], ['==', ['get', 'subclass'], 'subway_entrance']] },
      { id: 'transit-train',   label: 'R', color: '#212121', filter: ['all', ['==', ['get', 'class'], 'railway'], ['any', ['==', ['get', 'subclass'], 'station'], ['==', ['get', 'subclass'], 'halt']]] },
      { id: 'transit-tram',    label: 'L', color: '#EF6C00', filter: ['all', ['==', ['get', 'class'], 'railway'], ['==', ['get', 'subclass'], 'tram_stop']] },
      { id: 'transit-ferry',   label: 'F', color: '#0277BD', filter: ['==', ['get', 'class'], 'ferry_terminal'] }
    ];

    function createTransitIcon(letter, colorHex) {
      // Draw icon on a temporary canvas, extract raw pixels
      var size = 32;
      var canvas = document.createElement('canvas');
      canvas.width = size;
      canvas.height = size;
      var ctx = canvas.getContext('2d');
      var r = size / 2;
      // White border
      ctx.beginPath();
      ctx.arc(r, r, r - 1, 0, Math.PI * 2);
      ctx.fillStyle = 'white';
      ctx.fill();
      // Colored fill
      ctx.beginPath();
      ctx.arc(r, r, r - 3, 0, Math.PI * 2);
      ctx.fillStyle = colorHex;
      ctx.fill();
      // Letter
      ctx.fillStyle = 'white';
      ctx.font = 'bold 16px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(letter, r, r + 1);
      // Extract as raw Uint8Array
      var imageData = ctx.getImageData(0, 0, size, size);
      return { width: size, height: size, data: new Uint8Array(imageData.data.buffer) };
    }

    function addTransitLayers() {
      transitTypes.forEach(function (t) {
        var iconName = t.id + '-icon';
        if (!map.hasImage(iconName)) {
          map.addImage(iconName, createTransitIcon(t.label, t.color));
        }
        if (map.getLayer(t.id)) return;
        map.addLayer({
          id: t.id,
          type: 'symbol',
          source: 'openmaptiles',
          'source-layer': 'poi',
          minzoom: 12,
          filter: t.filter,
          layout: {
            'icon-image': iconName,
            'icon-allow-overlap': false,
            'icon-padding': 2,
            'text-field': ['step', ['zoom'], '', 14, ['coalesce', ['get', 'name:sv'], ['get', 'name']]],
            'text-font': ['Roboto Regular'],
            'text-size': 11,
            'text-offset': [0, 1.4],
            'text-anchor': 'top',
            'text-optional': true,
            'visibility': transitVisible ? 'visible' : 'none'
          },
          paint: {
            'text-color': t.color,
            'text-halo-color': 'white',
            'text-halo-width': 1.5
          }
        });
      });
    }

    function setTransitVisibility(visible) {
      transitVisible = visible;
      transitTypes.forEach(function (t) {
        if (map.getLayer(t.id)) map.setLayoutProperty(t.id, 'visibility', visible ? 'visible' : 'none');
      });
    }

    document.getElementById('toggle-transit').addEventListener('change', function () {
      setTransitVisibility(this.checked);
    });

    // Restaurants & cafes (clustered GeoJSON, inlined as compact array)
    // Data: [lon, lat, name, type] for ~6800 Stockholm restaurants/cafes/bars
    var RESTAURANT_DATA = [[18.0731,59.3104,"Bacchi Syre \u2013 Kaf\u00e9 & Restaurang","restaurant"],[17.956,59.3087,"Villa Fridhem","restaurant"],[17.8612,59.414,"Alddimashki","restaurant"],[18.0954,59.2969,"S\u00f6dergruvan","restaurant"],[18.0384,59.3582,"Waan Thai","restaurant"],[18.0221,59.3008,"Il Forno","restaurant"],[18.0046,59.3383,"Bella Pasto","restaurant"],[17.9787,59.3662,"K-m\u00e4rkt Solna Strand","restaurant"],[18.1018,59.3233,"Bistro Kajen","restaurant"],[17.9553,59.3598,"Tasty Sushi","restaurant"],[18.0831,59.2975,"Gildas rum","cafe"],[18.0902,59.3052,"Texas Longhorn","restaurant"],[18.0698,59.3313,"Corella \u00d6stermalm","cafe"],[17.9436,59.4093,"Midan","fast_food"],[18.0696,59.3313,"Kladdkakan","cafe"],[18.0583,59.3369,"Retro","restaurant"],[17.8498,59.2462,"","restaurant"],[17.849,59.347,"Lov\u00f6 magasin","cafe"],[17.9444,59.3868,"Babas Burger and Bites","fast_food"],[18.0209,59.3593,"Mazati K\u00f6k & Bar","restaurant"],[18.0148,59.3197,"Str\u00e5ket","restaurant"],[18.0651,59.3246,"Eriksdalshallens Mat & Caf\u00e9","restaurant"],[18.0762,59.3262,"Grand Caf\u00e9","cafe"],[17.8652,59.3981,"Subway","fast_food"],[18.0726,59.343,"Eataly","restaurant"],[17.987,59.2414,"Lax Sushi Huddinge","restaurant"],[18.0998,59.3314,"Sakana","fast_food"],[18.0799,59.3191,"Marley Coffee","cafe"],[18.0814,59.2639,"Kaffe & Restaurang Express Colombia","restaurant"],[18.0715,59.3316,"\u00d6stra Bageriet","cafe"],[18.0603,59.3336,"Den gamle och havet","restaurant"],[18.0087,59.3441,"Eatery","restaurant"],[18.0617,59.3458,"Caf\u00e9 Ami","cafe"],[18.0686,59.3315,"Lilla Karachi","restaurant"],[18.0401,59.3545,"Wilmer","cafe"],[18.163,59.3016,"Paralife Sportscaf\u00e9","cafe"],[17.8116,59.2981,"Eker\u00f6 Centrum Thai Wok & Sushi","restaurant"],[18.0934,59.2509,"Newcastle Inn","restaurant"],[18.1627,59.3236,"J\u00c4ST & TIMJAN","cafe"],[17.9812,59.3796,"Kolbeh","restaurant"],[18.0674,59.2652,"Myrans Grill Och Pizza","fast_food"],[18.057,59.3367,"Ethiostar","restaurant"],[18.0305,59.3007,"Marrakech Resturang","restaurant"],[18.0402,59.354,"Indian street food","restaurant"],[17.9581,59.2207,"Ivan's Grill","restaurant"],[18.0109,59.3548,"Greven & betj\u00e4nten","restaurant"],[18.1018,59.2327,"Farsta Wok & Sushi","fast_food"],[18.0343,59.3169,"Babel Bazaar","restaurant"],[17.9571,59.3581,"Dolks K\u00f6k Restaurang & Caf\u00e9","restaurant"],[17.9521,59.4067,"Food&Co","restaurant"],[18.0602,59.3581,"Oskar's k\u00f6k & bar","pub"],[17.947,59.3882,"Zenit","restaurant"],[18.0493,59.3518,"Mam Thai Wok","fast_food"],[18.0313,59.2948,"\u00c5rsta k\u00f6k","restaurant"],[18.0742,59.3328,"Zum Franziskaner","restaurant"],[18.0261,59.3671,"Restaurang Paradis","restaurant"],[18.1651,59.3011,"Taco Bar","fast_food"],[17.8801,59.2675,"Solg\u00e5rden Pizzeria","restaurant"],[18.1042,59.3289,"","fast_food"],[18.0664,59.3216,"Jacqueline\u2019s","bar"],[18.0875,59.3441,"Selma Deli","cafe"],[17.9711,59.379,"Restaurang Libaneza","restaurant"],[18.06,59.3577,"Reggev Hummus","restaurant"],[17.9499,59.439,"Al Capriccio","restaurant"],[18.0705,59.3439,"Bodybuddy","cafe"],[18.0338,59.3434,"un Italioano","restaurant"],[18.3044,59.4067,"","cafe"],[18.0709,59.3089,"Sallys Ristorante","restaurant"],[18.0869,59.3173,"Dirty Taco","fast_food"],[18.0601,59.354,"Monte Bello","fast_food"],[18.0711,59.332,"Corvina","bar"],[17.9953,59.2894,"Krubb","restaurant"],[18.0826,59.2367,"Farsta V\u00e4rdshus","restaurant"],[17.9279,59.3762,"Damal Coffe","cafe"],[17.9025,59.3953,"Tensta Restaurang","pub"],[18.0837,59.3198,"Bistro Boheme","restaurant"],[18.0161,59.3436,"Mormors pastabageri","restaurant"],[18.1317,59.3471,"Djurg\u00e5rdsbrunn","restaurant"],[18.034,59.3375,"Lundberg","restaurant"],[17.9447,59.4269,"Moilt Sushi Bar","restaurant"],[18.0149,59.3205,"Food & Co","restaurant"],[17.948,59.3654,"Bromma Kebab","fast_food"],[18.0654,59.3467,"Brazilia Restaurang","restaurant"],[18.0406,59.3547,"Vanadis Sushibar","restaurant"],[18.0575,59.3244,"icha icha","fast_food"],[18.0695,59.3178,"Stavros","restaurant"],[18.0454,59.3516,"Red Rover","restaurant"],[17.9999,59.374,"Marrakech","restaurant"],[18.0524,59.354,"Lilla Prag","restaurant"],[18.0626,59.3748,"Restaurang Professorn","pub"],[18.0112,59.3797,"Sazna Fusion","restaurant"],[18.0689,59.2982,"Forno S\u00f6der","restaurant"],[18.0436,59.3506,"Pizza Express City","fast_food"],[18.083,59.2665,"Mickel R\u00e4v","pub"],[18.0833,59.3091,"Sj\u00f6staden Skybar","restaurant"],[18.0767,59.3246,"Lagerbaren","restaurant"],[17.9142,59.3651,"Samy\u2019s Krog","restaurant"],[18.0855,59.3221,"Ashima","restaurant"],[18.071,59.3144,"Spago","restaurant"],[17.9966,59.3584,"East end Company","pub"],[18.0716,59.357,"Coup d'Etat","restaurant"],[18.1001,59.3328,"Skroten","cafe"],[18.0229,59.3005,"Caf\u00e9 Nero","cafe"],[17.999,59.3792,"Lulu","restaurant"],[18.0468,59.3248,"Jeb\u00e9na","restaurant"],[18.0614,59.3572,"Sue Ellen","restaurant"],[18.0318,59.3519,"Haga Bottega","restaurant"],[18.0727,59.31,"Caf\u00e9 Piazza","cafe"],[18.0804,59.293,"Grekiska kolgrillsbaren","fast_food"],[18.0758,59.3414,"Napolyon","restaurant"],[18.0049,59.3482,"Nonni Sushi","restaurant"],[18.0845,59.2969,"Bistroteket","restaurant"],[18.042,59.3252,"R\u00e5dhusbaren","restaurant"],[18.131,59.3803,"Ryan's Thai","restaurant"],[18.1175,59.3069,"Sushi Oishii","fast_food"],[17.9071,59.2893,"Shamali","restaurant"],[18.0079,59.327,"Dallas Pizza och Burgare","fast_food"],[18.2284,59.2541,"Burger King","fast_food"],[17.8649,59.2346,"Gula Villan Tr\u00e4dg\u00e5rdscaf\u00e9","cafe"],[18.1653,59.3239,"Brown Bull","restaurant"],[18.0323,59.3205,"Le Bistro","restaurant"],[18.0468,59.333,"Skvallerh\u00f6rnan","restaurant"],[18.0397,59.3558,"20hundra5","bar"],[17.9264,59.4024,"Al Sindibad","fast_food"],[18.0163,59.3735,"Il Palazzo","restaurant"],[18.0803,59.3394,"Spanjorskan","restaurant"],[18.0903,59.3364,"Paraden","restaurant"],[18.0311,59.3217,"Poli","cafe"],[18.0181,59.3802,"Vigor & Joy\u2019s Caf\u00e9","cafe"],[18.0783,59.324,"Sono","restaurant"],[18.0588,59.3243,"Rackarbacken","restaurant"],[18.0625,59.3424,"Oves hjulkorv","fast_food"],[18.0732,59.3188,"Espresso House","cafe"],[18.0594,59.3242,"The Capital","bar"],[17.9704,59.346,"Marrakech","restaurant"],[18.0306,59.3802,"Silvert\u00e4ltet","cafe"],[18.004,59.2875,"Svenska Sushik\u00f6ket","restaurant"],[18.1034,59.3018,"Marina tapas restaurang","restaurant"],[18.0776,59.3417,"Husman's Deli","restaurant"],[18.0709,59.3439,"Barrels","fast_food"],[18.0276,59.3906,"Kaf\u00e9 Sj\u00f6stugan","cafe"],[18.1055,59.3088,"rbg Bar and Grill","restaurant"],[18.0679,59.323,"Eggs Inc.","restaurant"],[18.0602,59.343,"Thelins","cafe"],[18.0684,59.3228,"Starbucks","cafe"],[18.0571,59.3455,"IceBar","bar"],[18.0588,59.3545,"Shun Xin","fast_food"],[18.0039,59.3522,"V\u00e4stra Skogen","bar"],[17.9764,59.3594,"Pita i parken","restaurant"],[18.0589,59.2996,"Agapi","restaurant"],[18.0548,59.3147,"H\u00e4ktet","restaurant"],[17.949,59.4064,"El Birria","restaurant"],[18.0992,59.2565,"Daisy's","fast_food"],[17.8998,59.3864,"Caledonian Inn","pub"],[17.9466,59.3243,"Brasserie Maison","restaurant"],[17.9662,59.2808,"Woktory","restaurant"],[18.0702,59.3092,"The Liffey","pub"],[17.989,59.3786,"H\u00e5kans Restaurang","restaurant"],[18.1331,59.3451,"Kvarters","restaurant"],[18.0783,59.3015,"Sono","restaurant"],[18.0603,59.3378,"Keemchi","restaurant"],[18.0732,59.3217,"Vau de Ville","restaurant"],[17.9336,59.4557,"3M\u00e5ltider Sushi & Wok","restaurant"],[18.0547,59.333,"Subculture","fast_food"],[18.0624,59.3545,"Br\u00f6d & Salt","cafe"],[18.0685,59.3351,"Freyja","restaurant"],[18.0592,59.3208,"Keemchi","restaurant"],[18.0863,59.3652,"Mare Blu","cafe"],[18.0014,59.2846,"Klockhusk\u00f6ket","restaurant"],[18.0717,59.3452,"Bar Burger Caf\u00e9","cafe"],[17.8383,59.434,"Sushi & Curry House","restaurant"],[18.0822,59.2973,"Vinfoaj\u00e9n","restaurant"],[18.097,59.3357,"OK OK","restaurant"],[17.9389,59.2304,"Casa Bianca","restaurant"],[18.0831,59.3011,"Brewdog S\u00f6dermalm","pub"],[18.0884,59.3457,"Texas Longhorn","restaurant"],[18.1018,59.2928,"Bonne Femme Stenugnsbageri","cafe"],[18.0392,59.3568,"La Pizza","fast_food"],[18.1231,59.3573,"Pizzeria Royal","fast_food"],[18.0732,59.3104,"\u00d6UR","restaurant"],[18.0296,59.302,"German Beer Hall Liljeholmen","restaurant"],[17.938,59.3004,"Daisy's","fast_food"],[18.0297,59.3461,"Banyan","restaurant"],[18.0576,59.3466,"Piccolo Panefresco","restaurant"],[17.9797,59.3763,"Lilla N\u00e4ckrosen","fast_food"],[18.0572,59.3244,"Taco Bar","fast_food"],[17.8015,59.4001,"Piccola Viksj\u00f6 Pizzeria","restaurant"],[18.1008,59.3395,"H\u00f6gkvarteret bar & matsal","restaurant"],[18.094,59.346,"Ponte Fiore","restaurant"],[18.0299,59.3885,"Who'else","restaurant"],[18.0634,59.3152,"Chic Konditori","cafe"],[18.0941,59.2308,"Pizzeria Lilla Bas","fast_food"],[17.9993,59.3427,"Pizzeria Kristineberg","fast_food"],[18.0647,59.3015,"Isaki","fast_food"],[17.9459,59.3447,"","fast_food"],[18.0707,59.3097,"Formosa","restaurant"],[18.0356,59.338,"Trattoria Corazza","restaurant"],[18.0742,59.3103,"Zum Franziskaner","restaurant"],[18.0839,59.3239,"Happy","cafe"],[17.9952,59.2352,"Alfreds Caf\u00e9","cafe"],[18.0604,59.3524,"Bastard Burgers","restaurant"],[18.0894,59.233,"ISOT","fast_food"],[17.9956,59.38,"La Pizza","restaurant"],[18.0702,59.3443,"Fafelle","fast_food"],[18.1234,59.3047,"Naked Juice Bar","cafe"],[18.0739,59.355,"Vallhallagrillen","fast_food"],[17.8052,59.4464,"Gilles pizza och konditori","cafe"],[18.0776,59.3193,"Husman's Deli","restaurant"],[18.0413,59.3258,"Mahalo","cafe"],[18.0586,59.3213,"Bun Bun","fast_food"],[17.8454,59.2718,"Kolmilan","restaurant"],[17.9509,59.3016,"Il Forno di Fru\u00e4ngen","restaurant"],[18.0621,59.3545,"Ting Ting","fast_food"],[18.1651,59.301,"Babas burger & bites","fast_food"],[18.0406,59.3449,"Le Passepartout","restaurant"],[18.0127,59.3072,"Kransens Wok","fast_food"],[17.9077,59.2677,"Naked Juice Bar","fast_food"],[18.0018,59.3078,"Wild Flower Bakehouse Caf\u00e9","cafe"],[18.0803,59.3389,"Nyko Kitchen","restaurant"],[17.9442,59.4093,"Ikki","fast_food"],[18.0891,59.3173,"Br\u00e4nnerian","bar"],[18.0528,59.3149,"Folkets kebab","fast_food"],[18.2139,59.2553,"Lilla Italien","restaurant"],[17.9291,59.3787,"Amat Fast Food And Sweets","fast_food"],[18.0913,59.2551,"Sushi Kawa","restaurant"],[18.0715,59.354,"\u00d6stra Bageriet","cafe"],[18.0915,59.2326,"Espresso House","cafe"],[17.9751,59.3794,"Restaurang F\u00e5gelboet","restaurant"],[17.9622,59.3583,"Chateau Liban","restaurant"],[18.0876,59.3173,"Punk Royale","restaurant"],[18.0623,59.3209,"Nem Nem Quan","restaurant"],[18.0721,59.3427,"Sempre","cafe"],[17.999,59.3639,"Korv-Ingvar","fast_food"],[18.0298,59.3803,"V\u00e4rdshuset Koppart\u00e4lten","cafe"],[18.0686,59.378,"Cafe Stockan","cafe"],[18.0831,59.3201,"Brasserie Bobonne","restaurant"],[18.0579,59.3373,"Cha Talk","cafe"],[18.0165,59.3761,"Chai yo","restaurant"],[18.0677,59.3418,"K25","food_court"],[18.0945,59.2633,"Enskede Bakg\u00e5rd","cafe"],[18.1002,59.331,"","fast_food"],[18.0719,59.2889,"\u00c5rsta krog","restaurant"],[18.0018,59.3857,"Anime sushi & ramen","restaurant"],[18.096,59.3542,"Erna's","cafe"],[18.0269,59.3198,"Miss Puri","restaurant"],[18.0581,59.3406,"Bar oas","bar"],[18.0755,59.298,"La Cucaracha","restaurant"],[18.0587,59.3506,"Don Corleone","restaurant"],[18.0617,59.3377,"Paladar de Cuba","restaurant"],[18.0475,59.278,"Burger Mansion","fast_food"],[18.0601,59.3206,"Yushi","fast_food"],[17.9701,59.3918,"Hallonbergens Grill","fast_food"],[18.0075,59.2859,"Biocaf\u00e9 Tellus","cafe"],[18.0066,59.3389,"Marrakech","restaurant"],[17.9325,59.4412,"Subway","fast_food"],[18.0292,59.3033,"Sj\u00f6viks pizza & kebab","fast_food"],[17.8292,59.2153,"Sibylla","fast_food"],[18.0718,59.3325,"The Temple Bar","pub"],[18.0724,59.3458,"Caf\u00e9 Eugenia","cafe"],[18.0173,59.327,"Nyhetsgrillen","fast_food"],[18.0722,59.3321,"Paganini","restaurant"],[18.0065,59.3563,"K4 Pampas","restaurant"],[17.8117,59.275,"Eker\u00f6grillen","restaurant"],[17.9292,59.3793,"Somali Star","restaurant"],[18.0904,59.392,"Sibylla","fast_food"],[18.068,59.3089,"Nara De K-Bar Gamla Stan","restaurant"],[17.9071,59.2668,"Shamali","restaurant"],[18.0048,59.3321,"Moonya sushi","fast_food"],[17.9273,59.4,"Rinkeby Restaurang","restaurant"],[17.8607,59.2503,"Pascha","fast_food"],[18.0253,59.3144,"Reimersholme Hotel Matbaren","restaurant"],[17.9283,59.3791,"Indisk Restaurang","restaurant"],[18.0514,59.2908,"Antica Edessa","restaurant"],[18.0218,59.3232,"Sushi Yama","restaurant"],[18.0407,59.3578,"800 grader","restaurant"],[18.0819,59.2978,"Yttons","bar"],[18.0515,59.3154,"Wok & Sushi","fast_food"],[18.0061,59.3567,"Caf\u00e9 K\u00e4rven","cafe"],[17.964,59.3588,"Bonab Persisk kolgrill","restaurant"],[18.0931,59.3243,"Strandh\u00e4xan","bar"],[18.0882,59.3408,"east india","restaurant"],[18.0812,59.3211,"Shinjuku","fast_food"],[18.0587,59.3251,"Caff\u00e9 Ritazza","cafe"],[18.0154,59.3083,"Tegelbruket","cafe"],[18.1309,59.2664,"Caf\u00e9 Cannella","cafe"],[18.0584,59.3248,"Sushi Yama","restaurant"],[18.1641,59.3002,"Karibu Sushi & Pok\u00e9","fast_food"],[18.0485,59.3413,"Ritorno","cafe"],[17.9958,59.2878,"Pizzeria Italia","fast_food"],[17.9437,59.3868,"lebanese food","fast_food"],[17.9511,59.387,"JP caf\u00e9","restaurant"],[18.0848,59.3183,"Tripletta","restaurant"],[18.0572,59.3443,"Gioia","restaurant"],[18.0582,59.3823,"Nonno's","restaurant"],[18.0607,59.3386,"Tullen","pub"],[18.0526,59.3341,"Bryggeriet","restaurant"],[18.0573,59.322,"Wayne\u2019s Coffee","cafe"],[18.1049,59.3288,"Gamla Krogen","cafe"],[17.9058,59.3359,"Astrids skafferi","restaurant"],[18.075,59.2974,"Delivore","cafe"],[18.0812,59.3204,"Brickyard","restaurant"],[18.0763,59.3207,"Chutney","restaurant"],[17.9416,59.3911,"Den Galne Kocken","bar"],[17.9109,59.2758,"O'Learys","restaurant"],[18.0466,59.3356,"Kinamuren","restaurant"],[18.1026,59.33,"Skansen Terrassen","restaurant"],[18.0283,59.3008,"Via loreto","restaurant"],[18.1689,59.3333,"Krua Thai","restaurant"],[17.9387,59.3263,"Appetito","restaurant"],[18.0112,59.2941,"WKB V\u00e4stberga","restaurant"],[17.9839,59.2928,"Catarina","restaurant"],[17.9865,59.2866,"Thanita's Thai","fast_food"],[18.0868,59.3442,"Pizzeria La Carda","restaurant"],[18.0618,59.3453,"Joe & The Juice","cafe"],[17.9772,59.3678,"Sabis","restaurant"],[17.9892,59.3337,"Essinge Wok","restaurant"],[18.0458,59.3282,"Dulce Tentacion","cafe"],[18.0147,59.2894,"Nancys Freshfood","restaurant"],[17.9211,59.2803,"Merhaba","restaurant"],[18.0627,59.3442,"Caffetteria del Corso","cafe"],[18.1657,59.3008,"O'Learys","pub"],[18.0712,59.3418,"Surfers","restaurant"],[17.9536,59.3867,"Marrakech","restaurant"],[17.9006,59.3531,"Ebi321","restaurant"],[18.0823,59.3202,"Omayma","cafe"],[18.0754,59.345,"Nybrogrillen","fast_food"],[17.8386,59.4112,"Niji Esoki","restaurant"],[17.9467,59.4103,"","cafe"],[18.0902,59.2806,"Tomi Sushi","restaurant"],[18.0071,59.3097,"Lux","restaurant"],[17.9828,59.361,"Kl\u00e5 Fann Thai","restaurant"],[18.0456,59.3388,"Tusi","restaurant"],[18.0533,59.3152,"Thai House Wok","fast_food"],[18.0648,59.3242,"Downtown Camper Caf\u00e9","cafe"],[18.0114,59.3597,"Haga Sportbar","bar"],[18.0457,59.3319,"Go Choo","restaurant"],[17.9062,59.2669,"Burgers n' shakes","restaurant"],[18.0009,59.3559,"Korvbyr\u00e5n","fast_food"],[18.0573,59.3564,"Kimchi","restaurant"],[17.8009,59.4226,"Resturang GOA","restaurant"],[18.0575,59.3399,"Restore Greens","fast_food"],[18.0234,59.3593,"Mama Gi\u00f2","restaurant"],[18.1329,59.2658,"Krua Thai","restaurant"],[18.1281,59.2758,"Skarpn\u00e4cks Sushi","restaurant"],[18.0654,59.3207,"Ginza sushi","fast_food"],[18.0246,59.3307,"J\u00f6ns Jacob Sodexo","restaurant"],[18.0586,59.3364,"W\u00e4ng Izakaya","restaurant"],[18.0848,59.2746,"Frozzy","fast_food"],[18.1055,59.3287,"","fast_food"],[18.1318,59.2889,"Mj\u00f6lkbaren","restaurant"],[18.0773,59.3375,"Sushi Oi","restaurant"],[18.0839,59.3233,"Polhem","pub"],[18.09,59.3372,"Phil's burger","restaurant"],[18.053,59.3219,"Lilla Italia","fast_food"],[17.9791,59.2377,"Epic Burgers","fast_food"],[17.9986,59.3107,"A.B.Caf\u00e9","cafe"],[18.0376,59.3348,"Abyssinia","restaurant"],[18.0156,59.3669,"Pita Baren - Grekisk gyros","restaurant"],[17.9055,59.2684,"Silvias k\u00f6k & bar","restaurant"],[18.0851,59.329,"Moderna bar","bar"],[18.1035,59.324,"Bakarna","cafe"],[18.0805,59.3461,"Lejonet & Bj\u00f6rnen","fast_food"],[17.8972,59.2555,"McDonald's","fast_food"],[18.1027,59.2924,"Hammarby Pizzeria","fast_food"],[18.0318,59.3207,"MacKinlay's Inn","pub"],[17.9098,59.2894,"Damascus Gate","restaurant"],[17.9009,59.3538,"Thai & Sushi","fast_food"],[18.0672,59.3245,"Tak","restaurant"],[18.0627,59.3218,"Caffetteria del Corso","cafe"],[18.0647,59.3137,"Tony's Pizza & Salad","restaurant"],[18.0885,59.3459,"Rockin Grill","fast_food"],[17.9865,59.3917,"Solna TennisCenter Caf\u00e9","cafe"],[17.9066,59.2908,"Kahramana","restaurant"],[18.0617,59.3006,"S&G","fast_food"],[17.9444,59.4273,"Shawarma ANAS Broasted","restaurant"],[17.9916,59.3044,"Pizza \u00d6rnsberg","fast_food"],[17.9283,59.4015,"Indisk Restaurang","restaurant"],[18.0689,59.3354,"Akkurat","pub"],[17.9294,59.401,"Shaah Macaan","cafe"],[18.0745,59.3,"La Piccola Nonna Pizza","restaurant"],[18.0156,59.3237,"Del Mare","fast_food"],[18.0477,59.3357,"Br\u00f6d & Salt","cafe"],[17.9692,59.4139,"Edsvikens Gelateria & Bistro Edge","cafe"],[18.0836,59.3368,"Ciao Ciao","cafe"],[18.011,59.2926,"Daisy's express","fast_food"],[18.0734,59.3357,"Pet Sounds Bar","bar"],[18.0692,59.3314,"Hanks Cafe","cafe"],[17.8836,59.3442,"R\u00e5cksta Sushi","restaurant"],[18.0686,59.3083,"Cork","bar"],[17.9511,59.4269,"La Pala Pizza","restaurant"],[18.0574,59.3352,"Caff\u00e8 Nero","cafe"],[18.0836,59.3152,"Hermans","restaurant"],[18.0724,59.3234,"Caf\u00e9 Eugenia","cafe"],[18.0829,59.3381,"Isol\u00e9","restaurant"],[18.0846,59.4548,"Starfish & Coffee","cafe"],[18.0332,59.3203,"Fluffy House","cafe"],[18.0362,59.3915,"Sushi Bar Kirin","fast_food"],[18.0013,59.374,"O'Learys","restaurant"],[18.0717,59.2978,"\u00c5s\u00f6 noodles","restaurant"],[18.0972,59.3355,"G\u00e4rdets Pizzeria","fast_food"],[18.0308,59.3203,"Il forno da Gino","restaurant"],[18.0036,59.3064,"JJ's","fast_food"],[18.0305,59.3562,"Haga Tr\u00e4dg\u00e5rdscaf\u00e9","cafe"],[18.0632,59.3436,"Reload Foodbar","fast_food"],[17.9656,59.3593,"Winner house","restaurant"],[18.075,59.3212,"invece","restaurant"],[18.0364,59.3387,"Bar Schiacciate","restaurant"],[18.064,59.3247,"Pong","fast_food"],[18.0313,59.3203,"Bastard Burgers","restaurant"],[18.0932,59.2804,"Dalens Grill","fast_food"],[17.9244,59.3218,"Drottningholms Pizzeria","restaurant"],[17.846,59.4356,"Sibylla","fast_food"],[18.0511,59.3194,"Hilma","bar"],[18.0734,59.3132,"Pet Sounds Bar","bar"],[18.0738,59.3449,"Calle P","restaurant"],[17.9415,59.369,"N\u00e1rges Restaurang","restaurant"],[17.9264,59.3129,"Caf\u00e9","cafe"],[18.0692,59.331,"Asian wokhouse","fast_food"],[18.0108,59.3573,"Bro-Wi Grillen","fast_food"],[18.0508,59.3132,"Hakams rullar och s\u00e5nt","fast_food"],[17.9673,59.3607,"Hawaii Pok\u00e9","restaurant"],[18.043,59.2572,"Kaffein","cafe"],[17.929,59.4012,"Romeo Caf\u00e9","cafe"],[18.0217,59.3005,"Caf\u00e9 Momo","cafe"],[18.0496,59.3568,"Espresso House","cafe"],[18.0403,59.3371,"Erlands","bar"],[17.9944,59.3859,"Veneto","restaurant"],[18.063,59.3371,"Banacado","cafe"],[18.068,59.3468,"Stockholm under Stj\u00e4rnorna","bar"],[18.0788,59.2429,"K\u00f6rsb\u00e4r kaf\u00e9","cafe"],[18.0403,59.3311,"B\u00fan B\u00f2 Hu\u00ea","restaurant"],[18.0711,59.3089,"Mr. Churros","fast_food"],[18.0811,59.3202,"Habibi Bar","restaurant"],[18.0868,59.3666,"Pizzeria La Carda","restaurant"],[17.8252,59.2312,"Botvid","restaurant"],[18.0766,59.2983,"demi","bar"],[18.2008,59.23,"Sushi Nikko","restaurant"],[18.0686,59.3461,"RC Cafe & Patisserie","restaurant"],[18.0374,59.3373,"Bistro Capitol","restaurant"],[18.0761,59.3008,"Mae Thai","fast_food"],[17.9526,59.3671,"ChopChop Asian Express","restaurant"],[17.9683,59.3588,"Brunnsbacken","restaurant"],[17.9437,59.2341,"Arom Kaffe & Deli","restaurant"],[17.9389,59.3388,"Rasmus grill","fast_food"],[18.0982,59.3001,"Ari's Corner","cafe"],[18.0388,59.3516,"Bastard Burgers","restaurant"],[18.035,59.3374,"Thai House Wok","fast_food"],[18.0732,59.3323,"Tre Valv","restaurant"],[18.0166,59.3718,"Bredbar","restaurant"],[18.0923,59.3367,"Stockholms glass & pastahus","cafe"],[18.0301,59.2883,"Subculture","fast_food"],[18.004,59.3804,"Pizza Express","fast_food"],[18.0822,59.2858,"Sushi Sun","fast_food"],[18.0717,59.3162,"Crumheaven","cafe"],[18.0418,59.3818,"","restaurant"],[18.0619,59.315,"","restaurant"],[18.0095,59.2867,"Subway","fast_food"],[17.9006,59.3548,"Pizzeria Deg o Vin","restaurant"],[17.9548,59.4078,"Factory","restaurant"],[18.0711,59.3138,"Joe & The Juice","cafe"],[18.0403,59.3547,"Espresso House","cafe"],[17.8826,59.2445,"Flottsbro V\u00e4rdshus","restaurant"],[17.8021,59.3998,"Vivels","cafe"],[18.0332,59.3184,"Barbro","restaurant"],[18.1133,59.3359,"Carotte","cafe"],[17.9646,59.359,"Thai Amari","restaurant"],[18.0723,59.3185,"Hawaii Pok\u00e9","restaurant"],[18.0364,59.3912,"Wayne's Coffee","cafe"],[18.0931,59.3135,"Pizzeria Rhodos","restaurant"],[18.0624,59.3433,"Nybroe Sm\u00f8rrebr\u00f8d","restaurant"],[18.0711,59.3437,"La Barra","restaurant"],[18.0891,59.4568,"Tito's","restaurant"],[18.0566,59.3435,"Bar City Central","pub"],[18.0754,59.342,"Sukai","restaurant"],[17.8322,59.4263,"Eddy's k\u00f6k och bar","restaurant"],[17.9206,59.2804,"S\u00e4tra Food House","restaurant"],[18.0796,59.2871,"Skanskvarn","cafe"],[17.9574,59.287,"N\u00e4stan hemma","cafe"],[18.0705,59.3305,"Restaurang Nymble","restaurant"],[17.8752,59.3598,"Mirella","fast_food"],[18.0468,59.358,"Esperanza","restaurant"],[18.0695,59.3246,"Hamburger B\u00f6rs","restaurant"],[18.0685,59.3459,"Wok House","restaurant"],[17.9695,59.3024,"Eolsh\u00e4lls 4 H-g\u00e5rd","cafe"],[18.0573,59.3444,"Wayne\u2019s Coffee","cafe"],[17.9684,59.3553,"Duvbo Grillen","fast_food"],[17.8885,59.2901,"Palmera Pizza & Grill","restaurant"],[18.0325,59.3214,"Max","fast_food"],[18.0468,59.3512,"Mandarin Paradis","restaurant"],[18.1354,59.2774,"BOC","fast_food"],[17.8849,59.3432,"R\u00e5cksta Krog","restaurant"],[18.0548,59.3561,"","cafe"],[18.0112,59.379,"Brasserie Sabis","restaurant"],[18.0781,59.3021,"Suris Street Food","restaurant"],[18.0161,59.2863,"Magic Masala","restaurant"],[18.0795,59.3126,"Bamses pizzeria","fast_food"],[17.9567,59.3654,"Waynes coffee","cafe"],[18.0539,59.3896,"Bockholmen Hav och Restaurang","restaurant"],[18.1136,59.2908,"Cornershop","cafe"],[18.0773,59.3432,"Italiano","restaurant"],[18.0741,59.3104,"Skeppsbar","bar"],[18.0955,59.2869,"Christers Matsal","restaurant"],[17.9748,59.2606,"Deli Italia Sn\u00e4ttringe","restaurant"],[18.0111,59.3167,"Gr\u00f6na Dalen","restaurant"],[17.9984,59.373,"Lion Bar Arenastaden","restaurant"],[18.169,59.3559,"Cleopatra","restaurant"],[18.1614,59.2448,"Kiosk, Cafe, snabbmat","fast_food"],[17.9968,59.3465,"Huvudsta pizzeria","restaurant"],[18.0522,59.3362,"Dino Sushi","restaurant"],[17.8612,59.4138,"Gurkmeja","restaurant"],[17.983,59.3451,"Joe & The Juice","cafe"],[18.0295,59.3154,"Indian Inn","restaurant"],[18.1232,59.2791,"Caf\u00e9 BKBK","cafe"],[18.056,59.3358,"Obsans Parklek","cafe"],[18.1651,59.3235,"Babas burger & bites","fast_food"],[18.0692,59.2981,"Nem Nem","restaurant"],[18.0973,59.3241,"Bryggans k\u00f6k & bar","restaurant"],[18.0106,59.2897,"Mejram","restaurant"],[17.9814,59.377,"Filmstadens Pizzeria & Caf\u00e9","restaurant"],[18.1111,59.2384,"Larsboda Husman","restaurant"],[18.0788,59.2654,"K\u00f6rsb\u00e4r kaf\u00e9","cafe"],[17.9408,59.3388,"Bromma Pizzeria","restaurant"],[18.0625,59.3583,"Farang","restaurant"],[17.8825,59.3672,"R\u00e5cksta Thai Wok","restaurant"],[18.0567,59.3231,"Swede Hollow","restaurant"],[18.0149,59.3458,"Buudai Sushi & Pok\u00e9 Bowl","fast_food"],[17.987,59.2189,"Lax Sushi Huddinge","restaurant"],[18.2026,59.2188,"Trollkrogen","restaurant"],[18.0502,59.324,"Restaurang Hong Kong","restaurant"],[18.0409,59.2571,"Bubble Tea","cafe"],[18.0398,59.3392,"Shanti","restaurant"],[18.2287,59.3004,"Pirlo pizza","fast_food"],[18.1519,59.3043,"Lavalhallen","restaurant"],[18.0158,59.3426,"Sushi Kultur","restaurant"],[18.0054,59.3379,"Pitcher's","restaurant"],[17.8548,59.4167,"Mackverket","fast_food"],[18.0841,59.3174,"Ristorante Deli di Luca","restaurant"],[17.9986,59.2883,"A.B.Caf\u00e9","cafe"],[18.0566,59.3335,"Mondo","bar"],[18.0345,59.3188,"YUC TANTO","fast_food"],[18.0242,59.3434,"Dede's","fast_food"],[17.9144,59.3874,"Ragnars K\u00f6k","restaurant"],[18.1159,59.3231,"Bistro \u00d6stberg","restaurant"],[18.0324,59.3352,"G\u00fcnters korvar","fast_food"],[18.0553,59.4437,"Spice Zone","restaurant"],[18.0751,59.315,"Woodstockholm","restaurant"],[18.0586,59.2986,"The Park Bistro","cafe"],[18.0576,59.3447,"MAP Petite Maison","bar"],[18.082,59.2968,"P\u00e4rlans","cafe"],[18.027,59.3245,"Let's Eat Sushi","restaurant"],[17.8643,59.3982,"Grekiska Grill & Bar","restaurant"],[17.9408,59.2342,"All\u00e9 Elva","restaurant"],[18.0254,59.3892,"Deli Italia","restaurant"],[17.9794,59.3446,"Alviksgrillen","fast_food"],[18.0712,59.3194,"NOUR","restaurant"],[18.0306,59.3578,"Silvert\u00e4ltet","cafe"],[17.8754,59.3643,"Fanoos","restaurant"],[17.9466,59.3468,"Brasserie Maison","restaurant"],[18.073,59.3209,"Pas d'art","cafe"],[18.0597,59.3466,"Vete-Katten","cafe"],[18.0408,59.2796,"Pepes","fast_food"],[18.1029,59.33,"Restaurant Soliden","restaurant"],[18.1281,59.2524,"Adam\u2019s Caf\u00e9 & Konditori","cafe"],[18.0618,59.3328,"Capannone","restaurant"],[18.0819,59.3197,"Ciao Ciao Grande","restaurant"],[18.0642,59.2986,"Wooh","restaurant"],[17.9488,59.2294,"","fast_food"],[18.0526,59.333,"Falafel Stockholm","fast_food"],[18.0709,59.3195,"International Bar","bar"],[18.0002,59.3124,"Caf\u00e9 Hitom","cafe"],[18.0018,59.2652,"V\u00e5r Pizza","restaurant"],[17.8984,59.4373,"Naturkaf\u00e9et","cafe"],[18.1002,59.367,"Suyaki sushi","fast_food"],[18.0618,59.3307,"Antu Kitchen","restaurant"],[17.8249,59.4308,"Kosar kolgrill","restaurant"],[18.0521,59.2541,"Anjas Vedugn","fast_food"],[18.1652,59.3011,"Burger King","fast_food"],[18.0704,59.3413,"Max","fast_food"],[18.0875,59.3119,"Willis","restaurant"],[18.0937,59.3415,"Pistage","cafe"],[18.0973,59.2993,"Sairu Sushi","restaurant"],[18.1107,59.3193,"Grand Palace","restaurant"],[18.0672,59.3006,"Grinden","restaurant"],[17.9951,59.2353,"Huddinge Pizzabutik","fast_food"],[18.0655,59.3576,"Bar N\u00eemes","bar"],[18.06,59.3424,"Dirty Coco","restaurant"],[17.9263,59.376,"Askeby Pizzeria & Grill","restaurant"],[18.077,59.3023,"Shaka Shaka","fast_food"],[18.028,59.3163,"Rosetta's","restaurant"],[18.0783,59.3134,"Kollektivet Livet","bar"],[18.0325,59.3213,"The Ship","pub"],[17.9696,59.367,"Beiruti","restaurant"],[18.092,59.3444,"Fiore","restaurant"],[18.0358,59.3394,"Saravanaa Bhavan","restaurant"],[18.0586,59.2988,"Bun Bun","fast_food"],[18.0345,59.3211,"Formaggio Pizzeria","fast_food"],[18.0482,59.3467,"Fatous","cafe"],[18.044,59.3287,"Orangeriet","restaurant"],[18.049,59.3344,"Tranan","restaurant"],[18.073,59.2819,"Thai house wok","restaurant"],[18.0389,59.3323,"Restaurang Delta","restaurant"],[18.0672,59.3469,"Tak","restaurant"],[17.9675,59.3611,"Subway","fast_food"],[17.9897,59.2891,"Gigis H\u00f6rna","restaurant"],[18.0602,59.3378,"Ta'ameya Falafel","restaurant"],[18.0772,59.3015,"OSO Omakase","fast_food"],[18.0603,59.356,"Den gamle och havet","restaurant"],[18.0826,59.2971,"Primo Ciao Ciao","restaurant"],[18.1025,59.2994,"Dalens Pizzeria","fast_food"],[18.0005,59.3679,"Tai Yoo Sushi Bar","restaurant"],[18.075,59.3243,"Stefano Catenacci","fast_food"],[18.0839,59.3317,"Petite Sabis Svea artilleri","restaurant"],[18.0375,59.3439,"Caf\u00e9 Bl\u00e5b\u00e4r","cafe"],[18.0502,59.3364,"Ashoka","restaurant"],[18.0676,59.3409,"Tabbouli","restaurant"],[17.8052,59.4466,"Kallh\u00e4lls sushi","restaurant"],[18.0445,59.3361,"Ritorno","cafe"],[18.0328,59.332,"Ino Izakaya","restaurant"],[18.0127,59.3677,"Gallo Nero","restaurant"],[18.0595,59.3416,"Caff\u00e8 Nero","cafe"],[18.1162,59.2662,"Oh Poke","restaurant"],[18.0713,59.3201,"Japanese Pub Mix","pub"],[18.0785,59.3219,"Pazzi","restaurant"],[18.0429,59.3227,"Agnes","restaurant"],[18.0563,59.3208,"Duvel Caf\u00e9","restaurant"],[18.0626,59.3434,"Pizza Hut","restaurant"],[18.075,59.3019,"Indian Street Food & Co","restaurant"],[18.015,59.3662,"ThaiMera","fast_food"],[18.065,59.2969,"Japan Food & Kitchen","restaurant"],[18.0609,59.3259,"Amazing Thai","restaurant"],[18.141,59.315,"SN\u00d6","cafe"],[18.1037,59.3237,"Indian Street Food & Co","restaurant"],[17.9943,59.3644,"Cafe Skytteholmsparken","cafe"],[18.0866,59.3181,"Caf\u00e9 Nizza","restaurant"],[17.9552,59.4117,"Beckers k\u00f6k","restaurant"],[18.0427,59.3454,"Nippon","fast_food"],[18.0564,59.2882,"Cr\u00eaperie Rustique","restaurant"],[18.0764,59.3015,"Gyrella","fast_food"],[18.0713,59.3142,"Old Beefeater Inn","pub"],[18.0711,59.3096,"Corvina","bar"],[18.0352,59.3145,"Caf\u00e9 Dello Sport","cafe"],[17.944,59.3868,"M.E.E.T","food_court"],[18.211,59.2118,"S\u00f6derg\u00e5rden","restaurant"],[18.1018,59.2924,"Tsuki Sushi & Ramen","restaurant"],[18.0076,59.3081,"Essinge Tapas","fast_food"],[18.0751,59.2986,"Mo Mo Cha SoFo","cafe"],[18.045,59.3221,"Itamae sushi bar","fast_food"],[18.164,59.3,"Oh Pok\u00e9","fast_food"],[17.9875,59.2195,"Il forno da Rosalita","fast_food"],[17.9661,59.3175,"","cafe"],[17.8553,59.4167,"Mevan Kolgrill","restaurant"],[17.9025,59.3959,"Spice Villa","restaurant"],[18.0623,59.3209,"Nem Nem","restaurant"],[18.0689,59.3083,"Lilla gatuk\u00f6ket","fast_food"],[18.1304,59.38,"Trattoria dell'isola","restaurant"],[17.9279,59.3263,"Nockeby bageri","cafe"],[18.0634,59.3219,"Taco Bar","fast_food"],[18.0538,59.3421,"Lao Lao City","restaurant"],[18.0707,59.3088,"House of Burgers","restaurant"],[18.0754,59.3226,"Nybrogrillen","fast_food"],[17.9932,59.2805,"\u00c4lvsj\u00f6 Pizzeria","restaurant"],[18.0912,59.3386,"Espresso House","cafe"],[18.0674,59.2876,"Myrans Grill Och Pizza","fast_food"],[18.0469,59.3359,"Kumo Ramen","fast_food"],[18.0595,59.3131,"Tehran Grill","restaurant"],[18.0594,59.3466,"The Capital","bar"],[18.0147,59.3118,"Nancys Freshfood","restaurant"],[17.9585,59.3026,"Caf\u00e9 Uddvillan","cafe"],[18.0825,59.3237,"Blecktornsk\u00e4llaren","restaurant"],[18.0799,59.2892,"Tullfritt S\u00f6der","fast_food"],[17.8173,59.365,"Caf\u00e9 Myntan","cafe"],[18.1137,59.3555,"Parsi","restaurant"],[17.9462,59.3446,"","bar"],[18.1221,59.3051,"Libanesen","restaurant"],[18.0589,59.3405,"Caliente","restaurant"],[18.0224,59.3594,"Haga Sushi","restaurant"],[17.9907,59.35,"Pizzeria Via Romana","restaurant"],[18.1555,59.3148,"Da Antonio e Lucia","restaurant"],[18.0708,59.2814,"Box sushi & poke","fast_food"],[18.0589,59.2686,"Ivanders Pizzeria","fast_food"]];
    var restaurantsVisible = document.getElementById('toggle-restaurants').checked;
    var restaurantsLoaded = false;

    function loadRestaurantGeoJSON() {
      var raw = RESTAURANT_DATA;
      return {
        type: 'FeatureCollection',
        features: raw.map(function (r) {
          return {
            type: 'Feature',
            geometry: { type: 'Point', coordinates: [r[0], r[1]] },
            properties: { name: r[2], type: r[3] }
          };
        })
      };
    }

    function addRestaurantLayers() {
      if (restaurantsLoaded) return;
      restaurantsLoaded = true;

      map.addSource('restaurants', {
        type: 'geojson',
        data: loadRestaurantGeoJSON(),
        cluster: true,
        clusterMaxZoom: 15,
        clusterRadius: 50
      });

      // Cluster circles — sized and colored by point count
      map.addLayer({
        id: 'restaurant-clusters',
        type: 'circle',
        source: 'restaurants',
        filter: ['has', 'point_count'],
        layout: { 'visibility': restaurantsVisible ? 'visible' : 'none' },
        paint: {
          'circle-color': [
            'step', ['get', 'point_count'],
            '#FFA726', 20,
            '#FB8C00', 50,
            '#F57C00', 100,
            '#EF6C00', 250,
            '#E65100'
          ],
          'circle-radius': [
            'step', ['get', 'point_count'],
            12, 20,
            16, 50,
            20, 100,
            26, 250,
            32
          ],
          'circle-stroke-color': 'white',
          'circle-stroke-width': 2
        }
      });

      // Cluster count labels
      map.addLayer({
        id: 'restaurant-cluster-count',
        type: 'symbol',
        source: 'restaurants',
        filter: ['has', 'point_count'],
        layout: {
          'text-field': ['get', 'point_count_abbreviated'],
          'text-font': ['Roboto Medium'],
          'text-size': 12,
          'text-allow-overlap': true,
          'visibility': restaurantsVisible ? 'visible' : 'none'
        },
        paint: {
          'text-color': 'white'
        }
      });

      // Individual points (unclustered)
      map.addLayer({
        id: 'restaurant-points',
        type: 'circle',
        source: 'restaurants',
        filter: ['!', ['has', 'point_count']],
        layout: { 'visibility': restaurantsVisible ? 'visible' : 'none' },
        paint: {
          'circle-radius': 5,
          'circle-color': '#FF6D00',
          'circle-stroke-color': 'white',
          'circle-stroke-width': 1.5
        }
      });

      // Individual point labels
      map.addLayer({
        id: 'restaurant-labels',
        type: 'symbol',
        source: 'restaurants',
        filter: ['!', ['has', 'point_count']],
        layout: {
          'text-field': ['get', 'name'],
          'text-font': ['Roboto Regular'],
          'text-size': 11,
          'text-offset': [0, 1.2],
          'text-anchor': 'top',
          'text-optional': true,
          'visibility': restaurantsVisible ? 'visible' : 'none'
        },
        paint: {
          'text-color': '#BF360C',
          'text-halo-color': 'white',
          'text-halo-width': 1.5
        }
      });

      // Click cluster to zoom in
      map.on('click', 'restaurant-clusters', function (e) {
        var clusterId = e.features[0].properties.cluster_id;
        map.getSource('restaurants').getClusterExpansionZoom(clusterId, function (err, zoom) {
          if (err) return;
          map.easeTo({ center: e.features[0].geometry.coordinates, zoom: zoom });
        });
      });

      map.on('mouseenter', 'restaurant-clusters', function () {
        map.getCanvas().style.cursor = 'pointer';
      });
      map.on('mouseleave', 'restaurant-clusters', function () {
        map.getCanvas().style.cursor = '';
      });
    }

    function setRestaurantsVisibility(visible) {
      restaurantsVisible = visible;
      var v = visible ? 'visible' : 'none';
      ['restaurant-clusters', 'restaurant-cluster-count', 'restaurant-points', 'restaurant-labels'].forEach(function (id) {
        if (map.getLayer(id)) map.setLayoutProperty(id, 'visibility', v);
      });
    }

    document.getElementById('toggle-restaurants').addEventListener('change', function () {
      if (this.checked && !restaurantsLoaded) addRestaurantLayers();
      setRestaurantsVisibility(this.checked);
    });

    // Style switcher
    var pendingStyleLoad = true;
    document.querySelectorAll('#style-switcher input[name="style"]').forEach(function (input) {
      input.addEventListener('change', function () {
        pendingStyleLoad = true;
        map.setStyle(TILE_SERVER + '/style/' + this.value);
      });
    });

    // Save original filters only on initial load and style switches (NOT on our own filter changes)
    map.on('styledata', function () {
      if (!pendingStyleLoad) return;
      pendingStyleLoad = false;
      setTimeout(function () {
        saveBoundaryFilters();
        if (!labelsVisible) setLabelsVisibility(false);
        if (!landBordersVisible || !seaBordersVisible) updateBorderFilters();
        addHeatmapLayer();
        addTransitLayers();
        if (restaurantsLoaded) { restaurantsLoaded = false; addRestaurantLayers(); }
      }, 100);
    });
  </script>
</body>
</html>
